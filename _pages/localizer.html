---
layout: page
title: "Browser extension localizer (i18n)"
description: "Automatically translate and localize your Chrome and Firefox extensions to reach a global audience.
Increase usage by up to 150% with internationalization (i18n)."
permalink: "/localizer"
---

<body>
  <section>
    <p class="mt-5">Translate your Chrome and Firefox extension to the <a
        href="https://developer.chrome.com/docs/extensions/reference/api/i18n#locales">52 supported locales</a>
      automatically, for free. </p>
    <p class="mt-4"><span class="drop-cap bg-warning">17.9%</span> Percentage of internet users who are fluent in
      English. For context, English is the most popular language in the world followed by Chinese at 14.3%. This
      highlights the importance of i18n to reaching a global audience.</p>
    <p class="mt-4"><span class="drop-cap bg-danger text-white">12.3%</span> Percentage of chrome extensions that are
      available in more than one language, based on data from <a
        href="https://chrome-stats.com/extension-stats">chrome-stats.com</a>. This underscores the difficulty of
      internationalizing a browser extension</p>
  </section>
  <section>
    <div class="card mb-4 mt-5 active" id="uploadCard">
      <div class="card-body">
        <h5 class="card-title">1. Upload Extension</h5>
        <p class="card-text">The zip file should include a manifest.json file in its root directory. The manifest file
          should set the default_locale field.</p>
        <div class="text-center">
          <input type="file" id="uploadZip" accept=".zip" style="display: none;">
          <button class="btn btn-primary" id="uploadBtn">Upload extension .zip</button>
        </div>
        <p class="text-center mt-2">OR</p>
        <div class="input-group mb-3 mt-3">
          <input type="text" id="extensionUrl" class="form-control" placeholder="Enter Chrome extension URL">
          <div class="input-group-append">
            <button class="btn btn-primary" type="button" id="fetchExtensionBtn" data-loading-text="Fetching...">Fetch
              extension</button>
          </div>
        </div>
        <div id="uploadMessage" class="mt-3"></div>
      </div>
    </div>
    <div class="card mb-4" id="translateCard">
      <div class="card-body">
        <h5 class="card-title">2. Translate</h5>
        <p class="card-text">Translate extension to all the 52 supported languages on the Chrome Webstore by <a href="#"
            id="selectLocalesLink">selecting target locales</a>.</p>
        <div id="localesList" class="locale-list bg-light border pl-3 pr-3 ml-n3 mr-n3" style="display: none;">
          <a id="deselectAllBtn" class="mt-2 d-block">Deselect All</a>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ar" id="locale-ar" checked>
            <label class="form-check-label" for="locale-ar">Arabic</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="am" id="locale-am" checked>
            <label class="form-check-label" for="locale-am">Amharic</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="bg" id="locale-bg" checked>
            <label class="form-check-label" for="locale-bg">Bulgarian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="bn" id="locale-bn" checked>
            <label class="form-check-label" for="locale-bn">Bengali</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ca" id="locale-ca" checked>
            <label class="form-check-label" for="locale-ca">Catalan</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="cs" id="locale-cs" checked>
            <label class="form-check-label" for="locale-cs">Czech</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="da" id="locale-da" checked>
            <label class="form-check-label" for="locale-da">Danish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="de" id="locale-de" checked>
            <label class="form-check-label" for="locale-de">German</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="el" id="locale-el" checked>
            <label class="form-check-label" for="locale-el">Greek</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="en" id="locale-en" checked>
            <label class="form-check-label" for="locale-en">English</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="en_AU" id="locale-en_AU" checked>
            <label class="form-check-label" for="locale-en_AU">English (Australia)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="en_GB" id="locale-en_GB" checked>
            <label class="form-check-label" for="locale-en_GB">English (GB)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="en_US" id="locale-en_US" checked>
            <label class="form-check-label" for="locale-en_US">English (USA)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="es" id="locale-es" checked>
            <label class="form-check-label" for="locale-es">Spanish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="es_419" id="locale-es_419" checked>
            <label class="form-check-label" for="locale-es_419">Spanish (LatAm)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="et" id="locale-et" checked>
            <label class="form-check-label" for="locale-et">Estonian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="fa" id="locale-fa" checked>
            <label class="form-check-label" for="locale-fa">Persian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="fi" id="locale-fi" checked>
            <label class="form-check-label" for="locale-fi">Finnish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="fil" id="locale-fil" checked>
            <label class="form-check-label" for="locale-fil">Filipino</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="fr" id="locale-fr" checked>
            <label class="form-check-label" for="locale-fr">French</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="gu" id="locale-gu" checked>
            <label class="form-check-label" for="locale-gu">Gujarati</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="he" id="locale-he" checked>
            <label class="form-check-label" for="locale-he">Hebrew</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="hi" id="locale-hi" checked>
            <label class="form-check-label" for="locale-hi">Hindi</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="hr" id="locale-hr" checked>
            <label class="form-check-label" for="locale-hr">Croatian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="hu" id="locale-hu" checked>
            <label class="form-check-label" for="locale-hu">Hungarian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="id" id="locale-id" checked>
            <label class="form-check-label" for="locale-id">Indonesian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="it" id="locale-it" checked>
            <label class="form-check-label" for="locale-it">Italian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ja" id="locale-ja" checked>
            <label class="form-check-label" for="locale-ja">Japanese</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="kn" id="locale-kn" checked>
            <label class="form-check-label" for="locale-kn">Kannada</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ko" id="locale-ko" checked>
            <label class="form-check-label" for="locale-ko">Korean</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="lt" id="locale-lt" checked>
            <label class="form-check-label" for="locale-lt">Lithuanian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="lv" id="locale-lv" checked>
            <label class="form-check-label" for="locale-lv">Latvian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ml" id="locale-ml" checked>
            <label class="form-check-label" for="locale-ml">Malayalam</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="mr" id="locale-mr" checked>
            <label class="form-check-label" for="locale-mr">Marathi</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ms" id="locale-ms" checked>
            <label class="form-check-label" for="locale-ms">Malay</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="nl" id="locale-nl" checked>
            <label class="form-check-label" for="locale-nl">Dutch</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="no" id="locale-no" checked>
            <label class="form-check-label" for="locale-no">Norwegian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="pl" id="locale-pl" checked>
            <label class="form-check-label" for="locale-pl">Polish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="pt_BR" id="locale-pt_BR" checked>
            <label class="form-check-label" for="locale-pt_BR">Portuguese (Brazil)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="pt_PT" id="locale-pt_PT" checked>
            <label class="form-check-label" for="locale-pt_PT">Portuguese (Portugal)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ro" id="locale-ro" checked>
            <label class="form-check-label" for="locale-ro">Romanian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ru" id="locale-ru" checked>
            <label class="form-check-label" for="locale-ru">Russian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="sk" id="locale-sk" checked>
            <label class="form-check-label" for="locale-sk">Slovak</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="sl" id="locale-sl" checked>
            <label class="form-check-label" for="locale-sl">Slovenian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="sr" id="locale-sr" checked>
            <label class="form-check-label" for="locale-sr">Serbian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="sv" id="locale-sv" checked>
            <label class="form-check-label" for="locale-sv">Swedish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="sw" id="locale-sw" checked>
            <label class="form-check-label" for="locale-sw">Swahili</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="ta" id="locale-ta" checked>
            <label class="form-check-label" for="locale-ta">Tamil</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="te" id="locale-te" checked>
            <label class="form-check-label" for="locale-te">Telugu</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="th" id="locale-th" checked>
            <label class="form-check-label" for="locale-th">Thai</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="tr" id="locale-tr" checked>
            <label class="form-check-label" for="locale-tr">Turkish</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="uk" id="locale-uk" checked>
            <label class="form-check-label" for="locale-uk">Ukrainian</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="vi" id="locale-vi" checked>
            <label class="form-check-label" for="locale-vi">Vietnamese</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="zh_CN" id="locale-zh_CN" checked>
            <label class="form-check-label" for="locale-zh_CN">Chinese (China)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="zh_TW" id="locale-zh_TW" checked>
            <label class="form-check-label" for="locale-zh_TW">Chinese (Taiwan)</label>
          </div>
        </div>
        <p id="defaultLocale" class="mt-2"></p>
        <p id="selectedLocales" class="mt-2"></p>
        <div id="localeNotice" class="alert alert-warning mt-2" style="display: none;"></div>
        <div class="text-center">
          <button id="translateBtn" class="btn btn-primary" disabled data-loading-text="Translating...">Begin
            translation</button>
        </div>
        <div class="progress mt-3" style="display: none;">
          <div id="translationProgress" class="progress-bar" role="progressbar" style="width: 0%; height: 100%"
            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div id="translateMessage" class="mt-3"></div>
      </div>
    </div>
    <div class="card mb-4" id="downloadCard">
      <div class="card-body">
        <h5 class="card-title">3. Download</h5>
        <p class="card-text">Click download to save your translated extension.</p>
        <div class="text-center">
          <button id="downloadBtn" class="btn btn-primary" disabled
            data-loading-text="Preparing files...">Download</button>
        </div>
        <div id="downloadMessage" class="mt-3"></div>
      </div>
    </div>
  </section>
  <section>
    <p class="mt-4 mb-4">This tool works for all addons that follow the <a
        href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions">WebExtensions spec</a>, including
      Chrome extensions, Firefox addons, Edge addons and Opera addons.</p>
    <p class="mt-4 mb-4">For information on how to internationalize your extension, see the <a
        href="https://developer.chrome.com/docs/extensions/reference/api/i18n">Chrome i18n documentation</a>.</p>
  </section>
  <style>
    .drop-cap {
      float: left;
      margin-right: 0.5rem;
      line-height: 0.8;
      border: 1px solid black;
      padding: 3px 6px;
    }

    .card.active {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border-color: #007bff;
    }

    .locale-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .locale-list .form-check {
      width: 33.33%;
      float: left;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>

  <script defer>
    const targetLocales = [
      "ar",
      "am",
      "bg",
      "bn",
      "ca",
      "cs",
      "da",
      "de",
      "el",
      "en",
      "es",
      "et",
      "fa",
      "fi",
      "fr",
      "gu",
      "he",
      "hi",
      "hr",
      "hu",
      "id",
      "it",
      "ja",
      "kn",
      "ko",
      "lt",
      "lv",
      "ml",
      "mr",
      "ms",
      "ml",
      "no",
      "pl",
      "pt",
      "ro",
      "ru",
      "sk",
      "sl",
      "sr",
      "sv",
      "sw",
      "ta",
      "te",
      "th",
      "tr",
      "uk",
      "vi",
      "zh-CN",
      "zh-TW",
    ];


    const x1 = "QUl6YVN5QktjRTNkNjVXVU";
    const x2 = "Z6VDJFTTlQSnJrZUtINFZDcThzelBn";

    document.addEventListener("DOMContentLoaded", async function () {
      var uploadedZip = null;
      var defaultLocale = "";

      // Function to handle the click event of the upload button
      function handleUploadButtonClick() {
        document.getElementById("uploadZip").click();
        gtag("event", "click", {
          event_category: "Upload",
          event_label: "Upload Button",
        });
      }

      // Function to handle the change event of the file input
      function handleFileInputChange(e) {
        var file = e.target.files[0];
        if (file && file.type === "application/zip") {
          uploadedZip = file;
          extractManifestFromZip(file);
          gtag("event", "upload", {
            event_category: "Upload",
            event_label: "Zip File",
          });
        } else {
          resetUploadedZip();
          displayUploadError("Invalid file type. Please upload a valid zip file.");
          gtag("event", "error", {
            event_category: "Upload",
            event_label: "Invalid File Type",
          });
        }
      }

      // Function to extract the manifest.json file from the zip
      function extractManifestFromZip(file) {
        console.log("extracting manifest file");
        JSZip.loadAsync(file)
          .then(function (zip) {
            if (zip.files["manifest.json"]) {
              zip
                .file("manifest.json")
                .async("string")
                .then(function (content) {
                  var manifest = JSON.parse(content);
                  defaultLocale = manifest.default_locale || "en";
                  gtag("event", "extract", {
                    event_category: "Manifest",
                    event_label: "Success",
                  });
                  if (zip.files["_locales/"]) {
                    updateDefaultLocale(defaultLocale);
                    enableTranslateButton();
                    displayUploadSuccess("Extension uploaded successfully!");
                    setActiveCard("translateCard");
                  } else {
                    displayUploadError(
                      'Missing "_locales" directory in the zip file.'
                    );
                    gtag("event", "error", {
                      event_category: "Manifest",
                      event_label: "Missing Locales Directory",
                    });
                  }
                });
            } else {
              displayUploadError('Missing "manifest.json" file in the zip file.');
              gtag("event", "error", {
                event_category: "Manifest",
                event_label: "Missing Manifest File",
              });
            }
          })
          .catch(function (error) {
            displayUploadError("Error extracting manifest file: " + error.message);
            gtag("event", "error", {
              event_category: "Manifest",
              event_label: "Extraction Error",
            });
          });
      }

      // Function to reset the uploaded zip and related UI elements
      function resetUploadedZip() {
        uploadedZip = null;
        updateDefaultLocale("");
        disableTranslateButton();
        disableDownloadButton();
        setActiveCard("uploadCard");
      }

      // Function to update the default locale UI element
      function updateDefaultLocale(locale) {
        document.getElementById("defaultLocale").textContent =
          "Detected Default Locale: " + locale;
      }

      // Function to enable the translate button
      function enableTranslateButton() {
        document.getElementById("translateBtn").disabled = false;
      }

      // Function to disable the translate button
      function disableTranslateButton() {
        document.getElementById("translateBtn").disabled = true;
      }

      // Function to disable the download button
      function disableDownloadButton() {
        document.getElementById("downloadBtn").disabled = true;
      }

      // Function to handle the click event of the select locales link
      function handleSelectLocalesLinkClick(event) {
        event.preventDefault();
        var localesList = document.getElementById("localesList");
        if (localesList.style.display === "none") {
          localesList.style.display = "block";
        } else {
          localesList.style.display = "none";
        }
      }

      // Uncheck all checkboxes
      function handleDeselectAllLocalsClick(event) {
        var checkboxes = document.querySelectorAll(
          '#localesList input[type="checkbox"]'
        );
        checkboxes.forEach(function (checkbox) {
          checkbox.checked = false;
        });
      }

      // Function to get selected locales
      function getSelectedLocales() {
        var selectedLocales = [];
        var checkboxes = document.querySelectorAll(
          '#localesList input[type="checkbox"]'
        );
        checkboxes.forEach(function (checkbox) {
          if (checkbox.checked) {
            selectedLocales.push(checkbox.value);
          }
        });
        return selectedLocales;
      }

      // Function to update translation progress
      function updateTranslationProgress(current, total) {
        var progressBar = document.getElementById("translationProgress");
        var progressPercentage = Math.round((current / total) * 100);
        progressBar.style.width = progressPercentage + "%";
        progressBar.setAttribute("aria-valuenow", progressPercentage);
        progressBar.innerHTML = `${progressPercentage}%`;

        // Show the progress bar and translation status when translation begins
        document.querySelector(".progress").style.display = "block";
      }

      // Function to handle the click event of the translate button
      function handleTranslateButtonClick() {
        if (uploadedZip) {
          var translateButton = document.getElementById("translateBtn");
          showLoadingSpinner(translateButton);
          translateExtension(uploadedZip)
            .then(() => {
              removeLoadingSpinner(translateButton);
            })
            .catch((error) => {
              removeLoadingSpinner(translateButton);
              displayTranslateError("Error translating extension: " + error.message);
            });
        }
      }

      function translateExtension(zip) {
        return JSZip.loadAsync(zip).then(function (zip) {
          return zip
            .file("_locales/" + defaultLocale + "/messages.json")
            .async("string")
            .then(function (content) {
              var messages = JSON.parse(content);
              var selectedLocales = getSelectedLocales();
              var translatedCount = 0;

              var mapToTranslate = getMapToTranslate(messages);
              var requestBody = createRequestBody(mapToTranslate, defaultLocale, selectedLocales);

              return sendTranslationRequest(requestBody)
                .then(function (translatedMessages) {
                  processTranslatedMessages(translatedMessages, selectedLocales, zip, translatedCount);
                  handleTranslationResult();
                })
                .catch(function (error) {
                  displayTranslateError("Error translating extension: " + error.message);
                });
            });
        });
      }

      function getMapToTranslate(messages) {
        var mapToTranslate = {};
        Object.keys(messages).forEach(function (key) {
          mapToTranslate[key] = messages[key].message;
        });
        return mapToTranslate;
      }

      function createRequestBody(mapToTranslate, fromLocale, targetLocales) {
        return {
          mapToTranslate: mapToTranslate,
          fromLocale: fromLocale,
          targetLocales: targetLocales,
        };
      }

      function sendTranslationRequest(requestBody) {
        return fetch("https://us-central1-xtension-project.cloudfunctions.net/translate2", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestBody),
        }).then(function (response) {
          return response.json();
        });
      }

      function processTranslatedMessages(translatedMessages, selectedLocales, zip, translatedCount) {
        selectedLocales.forEach(function (locale) {
          var translatedContent = {};
          Object.keys(translatedMessages[locale]).forEach(function (key) {
            translatedContent[key] = {
              // TODO: check didYouMean and autoCorrected.
              message: translatedMessages[locale][key]["text"],
            };
          });
          zip.file("_locales/" + locale + "/messages.json", JSON.stringify(translatedContent, null, 2));
          updateTranslationProgress(++translatedCount, selectedLocales.length);
        });
      }

      function handleTranslationResult() {
        enableDownloadButton();
        displayTranslateSuccess("Extension translated successfully!");
        setActiveCard("downloadCard");
      }

      function translateMessagesForLocale(messages, locale, apiKey) {
        return Object.keys(messages).map(function (key) {
          var message = messages[key].message;
          var url = "https://translation.googleapis.com/language/translate/v2?key=" + apiKey;
          url += "&q=" + encodeURIComponent(message);
          url += "&target=" + locale;
          return fetch(url)
            .then(function (response) {
              return response.json();
            })
            .then(function (data) {
              return {
                key: key,
                message: data.data.translations[0].translatedText,
              };
            });
        });
      }

      function processTranslatedMessages(translationPromises, zip, locale, selectedLocales, translatedCount) {
        return Promise.all(translationPromises).then(function (translatedMessages) {
          var translatedContent = {};
          translatedMessages.forEach(function (translatedMessage) {
            translatedContent[translatedMessage.key] = {
              message: translatedMessage.message,
            };
          });
          zip.file("_locales/" + locale + "/messages.json", JSON.stringify(translatedContent, null, 2));
          updateTranslationProgress(++translatedCount, selectedLocales.length);
        });
      }

      // Function to enable the download button
      function enableDownloadButton() {
        document.getElementById("downloadBtn").disabled = false;
      }

      // Function to handle the click event of the download button
      function handleDownloadButtonClick() {
        if (uploadedZip) {
          var downloadButton = document.getElementById("downloadBtn");
          showLoadingSpinner(downloadButton);
          downloadTranslatedExtension(uploadedZip)
            .then(() => {
              removeLoadingSpinner(downloadButton);
            })
            .catch((error) => {
              removeLoadingSpinner(downloadButton);
              displayDownloadError("Error downloading extension: " + error.message);
            });
        }
      }

      // Function to download the translated extension
      function downloadTranslatedExtension(zip) {
        return JSZip.loadAsync(zip).then(function (zip) {
          return zip.generateAsync({ type: "blob" }).then(function (content) {
            var link = document.createElement("a");
            link.href = URL.createObjectURL(content);
            link.download = "translated_extension.zip";
            link.click();
            displayDownloadSuccess("Extension downloaded successfully!");
          });
        });
      }

      // Function to handle the click event of the fetch extension button
      function handleFetchExtensionButtonClick() {
        var extensionUrl = document.getElementById("extensionUrl").value;
        var extensionIdPattern =
          /^https?:\/\/chromewebstore.google.com\/detail(?:\/[^\/]+)?\/([a-z]{32})(?=[\/#?]|$)/;
        var match = extensionUrl.match(extensionIdPattern);

        var fetchButton = document.getElementById("fetchExtensionBtn");
        if (match && match[1]) {
          var extensionId = match[1];
          showLoadingSpinner(fetchButton);
          fetchExtensionFromWebStore(extensionId).then(() => {
            removeLoadingSpinner(fetchButton);
          }).catch(error => {
            removeLoadingSpinner(fetchButton);
          });
          gtag("event", "click", {
            event_category: "Fetch Extension",
            event_label: "Fetch Button",
          });
        } else {
          displayUploadError("Invalid Chrome extension URL.");
          gtag("event", "error", {
            event_category: "Fetch Extension",
            event_label: "Invalid URL",
          });
        }
      }

      // Function to fetch extension from Chrome Web Store
      function fetchExtensionFromWebStore(extensionId) {
        let url = `https://us-central1-xtension-project.cloudfunctions.net/getExtensionUpdateUrl/?extensionId=${extensionId}`
        return fetch(url, { method: "GET" }).then(async (response) => {
          if (!response.ok) {
            throw new Error(
              "Failed to fetch extension from Chrome Web Store. status: ",
              response.status,
              response
            );
          }

          const data = await response.json();
          const blob = extractZipFromCRX(new Uint8Array(data.crx.data));
          uploadedZip = new File([blob], "extension.zip", {
            type: "application/zip",
          });
          extractManifestFromZip(uploadedZip);
          gtag("event", "fetch", {
            event_category: "Fetch Extension",
            event_label: "Success",
          });
        }).catch(function (error) {
          displayUploadError("Error fetching extension: " + error.message);
          gtag("event", "error", {
            event_category: "Fetch Extension",
            event_label: "Fetch Error",
          });
        });
      }

      function extractZipFromCRX(crxData) {
        const zipStartOffset =
          12 +
          (crxData[8] +
            (crxData[9] << 8) +
            (crxData[10] << 16) +
            ((crxData[11] << 24) >>> 0));
        return crxData.slice(zipStartOffset);
      }

      // Function to display upload error message
      function displayUploadError(message) {
        document.getElementById("uploadMessage").innerHTML =
          '<div class="alert alert-danger">' + message + "</div>";
      }

      // Function to display upload success message
      function displayUploadSuccess(message) {
        document.getElementById("uploadMessage").innerHTML =
          '<div class="alert alert-success">' + message + "</div>";
      }

      // Function to display translate error message
      function displayTranslateError(message) {
        document.getElementById("translateMessage").innerHTML =
          '<div class="alert alert-danger">' + message + "</div>";
      }

      // Function to display translate success message
      function displayTranslateSuccess(message) {
        document.getElementById("translateMessage").innerHTML =
          '<div class="alert alert-success">' + message + "</div>";
      }

      // Function to display download success message
      function displayDownloadSuccess(message) {
        document.getElementById("downloadMessage").innerHTML =
          '<div class="alert alert-success">' + message + "</div>";
      }

      // Function to set the active card
      function setActiveCard(cardId) {
        var cards = document.querySelectorAll(".card");
        cards.forEach(function (card) {
          card.classList.remove("active");
        });
        document.getElementById(cardId).classList.add("active");
      }

      // Function to handle the change event of the locale checkboxes
      function handleLocaleCheckboxChange() {
        var selectedLocales = getSelectedLocales();
        if (selectedLocales.length > 5) {
          this.checked = false;
          displayLocaleNotice(getSelectedLocales());
        } else {
          hideLocaleNotice();
          updateSelectedLocales(selectedLocales);
        }
      }

      // Function to display the locale notice
      function displayLocaleNotice(selectedLocales) {
        var localeNotice = document.getElementById("localeNotice");
        localeNotice.innerHTML =
          "You can only select up to 5 locales at a time (for now due to resource constraints). Selected: " +
          selectedLocales.join(", ");
        localeNotice.style.display = "block";
      }

      // Function to hide the locale notice
      function hideLocaleNotice() {
        document.getElementById("localeNotice").style.display = "none";
      }

      // Function to update the selected locales display
      function updateSelectedLocales(selectedLocales) {
        document.getElementById("selectedLocales").textContent =
          "Target Locales: " + selectedLocales.join(", ");
      }

      // Function to show the loading spinner on a button
      function showLoadingSpinner(button) {
        button.setAttribute('data-original-text', button.innerHTML);
        var loadingText = button.getAttribute('data-loading-text');
        button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ' + loadingText;
        button.disabled = true;
      }

      // Function to remove the loading spinner from a button
      function removeLoadingSpinner(button) {
        var originalText = button.getAttribute('data-original-text');
        button.innerHTML = originalText;
        button.disabled = false;
      }


      // Event listeners
      document
        .getElementById("uploadBtn")
        .addEventListener("click", handleUploadButtonClick);
      document
        .getElementById("uploadZip")
        .addEventListener("change", handleFileInputChange);
      document
        .getElementById("fetchExtensionBtn")
        .addEventListener("click", handleFetchExtensionButtonClick);
      document
        .getElementById("selectLocalesLink")
        .addEventListener("click", handleSelectLocalesLinkClick);
      // Function to handle the click event of the deselect all button
      document
        .getElementById("deselectAllBtn")
        .addEventListener("click", handleDeselectAllLocalsClick);
      document
        .getElementById("translateBtn")
        .addEventListener("click", handleTranslateButtonClick);
      document
        .getElementById("downloadBtn")
        .addEventListener("click", handleDownloadButtonClick);
    });

  </script>
</body>